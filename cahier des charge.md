# üìò Cahier des Charges : L'Agora du Village NIRD

**Version :** 1.0 (Nuit de l'Info 2025)
**Stack :** React (Vite ou Next.js), Supabase (Postgres), Vercel, Tailwind CSS.
**Concept :** Une plateforme souveraine et √©co-con√ßue pour connecter les talents du num√©rique responsable aux √©tablissements scolaires.

-----

## I. Architecture Technique & Dossiers

Pour gagner du temps, voici la structure de fichiers recommand√©e (compatible Next.js App Router ou React classique).

### 1\. Arborescence des dossiers

```bash
/src
  /components
    /ui           # Composants atomiques (Boutons, Cards, Badges, ToggleSobriete)
    /layout       # Header, Footer, Sidebar, LayoutSobriete
    /features     # Gros blocs fonctionnels
      /map        # Composant LeafletMap, MapMarkers
      /profile    # ProfileCard, SkillsList, ProjectHistory
      /admin      # VerificationTable
  /lib
    supabase.js   # Initialisation du client Supabase
    utils.js      # Fonctions utilitaires (calcul date, formatage)
  /hooks          # Custom hooks (useAuth, useSobrietyMode)
  /pages          # (ou /app sur Next.js) - Les routes de l'app
    /auth         # Login, Register
    /dashboard    # Espace perso
    /map          # La carte interactive
    /admin        # Back-office de validation
  /styles         # globals.css (Tailwind imports)
```

### 2\. Configuration Supabase (Client)

Dans `src/lib/supabase.js` :

  * Utilisation de `@supabase/supabase-js`.
  * Connexion via les variables d'environnement `VITE_SUPABASE_URL` et `VITE_SUPABASE_ANON_KEY` (ou `NEXT_PUBLIC_...`).

-----

## II. Mod√©lisation de la Base de Donn√©es (SQL)

Copiez-collez ce script directement dans l'√©diteur SQL de Supabase pour g√©n√©rer toute la structure en une fois. J'ai inclus les modifications pour le mode sobri√©t√© et l'impact carbone.

```sql
-- 1. Table des Utilisateurs (√âtend la table auth.users de Supabase)
CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  nom TEXT,
  prenom TEXT,
  role TEXT CHECK (role IN ('Enseignant', 'Technicien', 'Eco-delegue', 'Association', 'Administrateur')),
  badge_verified BOOLEAN DEFAULT FALSE, -- C≈ìur du d√©fi Capgemini
  preferences JSONB DEFAULT '{"mode_sobriete": false, "notifications": true}', -- Pour le mode Sobri√©t√©
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. Table de R√©f√©rence des Comp√©tences (Pour l'autocompl√©tion propre)
CREATE TABLE public.skill_refs (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  label TEXT UNIQUE NOT NULL, -- ex: "Linux", "R√©paration", "RGPD"
  category TEXT -- ex: "Technique", "Juridique"
);

-- 3. Table des Comp√©tences D√©clar√©es (Lien User <-> Skill)
CREATE TABLE public.user_skills (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  skill_name TEXT NOT NULL, -- On stocke le nom pour simplifier l'affichage
  level TEXT CHECK (level IN ('D√©butant', 'Interm√©diaire', 'Expert')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. Table des Projets (Preuves de comp√©tence + Impact Carbone)
CREATE TABLE public.projects (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  description TEXT,
  impact_carbone INT DEFAULT 0, -- En kg CO2 √©conomis√© (Feature Signature)
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 5. Table de Mise en Relation (Syst√®me de messagerie interne)
CREATE TABLE public.collaborations (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  requester_id UUID REFERENCES public.profiles(id),
  target_id UUID REFERENCES public.profiles(id),
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'rejected')),
  message TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- S√©curit√© basique pour le Hackathon (Ouvre tout, attention !)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Public Read" ON public.profiles FOR SELECT USING (true);
CREATE POLICY "Public Insert" ON public.profiles FOR INSERT WITH CHECK (true);
CREATE POLICY "Self Update" ON public.profiles FOR UPDATE USING (auth.uid() = id);
```

-----

## III. Sp√©cifications Fonctionnelles (Par Page)

### 1\. Page d'Accueil (`/`) - "La Vitrine Responsable"

  * **Objectif :** Convaincre et orienter.
  * **√âl√©ments cl√©s :**
      * **Le Compteur Global (Signature) :** Une requ√™te `SUM(impact_carbone)` sur la table `projects` affiche "X tonnes de CO2 √©vit√©es par le Village".
      * **Bouton Toggle Sobri√©t√© :** En haut √† droite. Au clic, passe le site en N\&B et supprime les images de fond.
      * **Call to Action :** "Rejoindre le r√©seau" (vers `/register`) ou "Acc√©der √† la carte" (vers `/map` - gris√© si pas connect√©).

### 2\. Module d'Inscription (`/register`) - "L'Enr√¥lement"

  * **Formulaire :**
      * Email / Password (G√©r√© par Supabase Auth).
      * Nom / Pr√©nom / R√¥le.
      * **Saisie des Talents :** Un champ avec auto-compl√©tion (tape dans `skill_refs`).
      * **Premier Projet (Obligatoire) :** "D√©crivez une action r√©alis√©e pour prouver votre engagement".
  * **Action Post-Submit :** Cr√©e l'user dans `auth` + cr√©e l'entr√©e dans `profiles` avec `badge_verified = FALSE`. Redirige vers une page "En attente de validation".

### 3\. Back-Office Admin (`/admin`) - "Le Conseil des Sages"

  * **Acc√®s :** Restreint aux users ayant `role === 'Administrateur'`.
  * **Interface :** Un tableau simple listant les profils o√π `badge_verified = FALSE`.
  * **Actions :**
      * Bouton "Voir Projets" (pour juger la cr√©dibilit√©).
      * Bouton **"Certifier"** : Passe `badge_verified` √† `TRUE`. D√©clenche l'acc√®s √† la carte pour l'utilisateur.

### 4\. La Carte Interactive (`/map`) - "Le C≈ìur du R√©acteur"

  * **Acc√®s :** Bloqu√© si `badge_verified` est faux.
  * **Librairie :** `react-leaflet`.
  * **Fonctionnalit√©s :**
      * **Affichage :** Pins g√©olocalis√©s des utilisateurs.
          * *Iconographie :* Cl√© √† molette (Technicien), Livre (Enseignant).
      * **Filtres (Sidebar) :** Checkboxes "Expert Linux", "R√©parateur", "Dispo imm√©diate".
      * **Interactions :**
          * Clic sur un Pin -\> Ouvre une "Modale Profil".
          * Dans la modale -\> Bouton "Collaborer" (Cr√©√© une entr√©e dans `collaborations`).
          * **Visualisation R√©seau :** Tracer une ligne entre deux users si une collaboration existe.

### 5\. Tableau de Bord Utilisateur (`/dashboard`)

  * **Profil :** Modifier ses infos.
  * **Switch Mode Sobri√©t√© :** Sauvegarde le choix dans la colonne `preferences` (JSON).
  * **Mes Donn√©es :** Bouton "Exporter au format JSON" (Respect RGPD/Souverainet√©).

-----

## IV. Guide d'Impl√©mentation (Chronologie)

1.  **H+0 √† H+1 (Setup) :**

      * Initialiser le repo Git.
      * Cr√©er le projet Supabase et lancer le script SQL ci-dessus.
      * Installer les d√©pendances React (`react-router-dom`, `leaflet`, `@supabase/supabase-js`, `lucide-react` pour les ic√¥nes).

2.  **H+1 √† H+3 (Auth & Data) :**

      * Coder les pages Login/Register.
      * Connecter le formulaire d'inscription √† la table `profiles`.
      * Faire la page Admin pour pouvoir valider manuellement vos propres comptes de test.

3.  **H+3 √† H+6 (Core Feature - La Carte) :**

      * Int√©grer Leaflet.
      * R√©cup√©rer les profils "Verified" depuis Supabase (`select * from profiles where badge_verified = true`).
      * Afficher les marqueurs.

4.  **H+6 √† Fin (Signature & Polish) :**

      * Impl√©menter le "Mode Sobri√©t√©" (Une classe CSS `.sobriety-mode` sur le `body` qui applique des filtres grayscale).
      * Ajouter le compteur Carbone sur la Home.
      * Peaufiner le CSS (Tailwind) pour le rendu "Pro".
